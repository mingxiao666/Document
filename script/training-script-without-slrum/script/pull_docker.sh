#!/bin/bash
set -e

# 所有节点IP列表
NODES=(
    "10.192.18.168"
    "10.192.18.163"
    "10.192.18.164"
    "10.192.18.167"
    "10.192.18.166"
    "10.192.18.169"
    "10.192.18.156"
    "10.192.18.155"
    "10.192.18.170"
    "10.192.18.152"
    "10.192.18.157"
    "10.192.18.160"
    "10.192.18.153"
    "10.192.18.165"
    "10.192.18.158"
    "10.192.18.159"
    "10.192.18.161"
    #"10.192.18.151"
)

# 在每个节点后台拉取镜像
echo "开始在所有节点拉取 nvcr.io/nvidia/nemo:25.07.01 镜像..."
for node in "${NODES[@]}"; do
    echo "发送拉取命令到节点: $node"
    # 利用现有免密登录，后台执行拉取并记录日志
    ssh root@"$node" "nohup docker pull nvcr.io/nvidia/nemo:25.07.01 > /root/nemo_pull.log 2>&1 &"
done

echo "所有节点拉取命令已下发完成！"
echo "查看单个节点进度的命令示例："
echo "ssh root@10.192.18.168 'tail -f /root/nemo_pull.log'"
